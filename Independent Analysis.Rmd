---
title: "CHEP898_Assignment4_Independent-Analysis-Part 1"
author: "Daoyi Huang"
date: "2026-02-22"
output: html_document
---

# 1. Identify a dataset

Since I am interested in cars, I chose a dataset about car prices prediction from the Kaggle website.     

**Data source:** The dataset used for this independent analysus was downloaded from the Kaggle website, titled Car Price Prediction Multiple Linear Regression.    

Link: https://www.kaggle.com/datasets/hellbuoy/car-price-prediction/data    

**Problem Statement (copied from the Kaggle website)**   

A Chinese automobile company Geely Auto aspires to enter the US market by setting up their manufacturing unit there and producing cars locally to give competition to their US and European counterparts.

They have contracted an automobile consulting company to understand the factors on which the pricing of cars depends. Specifically, they want to understand the factors affecting the pricing of cars in the American market, since those may be very different from the Chinese market. The company wants to know:

•Which variables are significant in predicting the price of a car   
•How well those variables describe the price of a car   

Based on various market surveys, the consulting firm has gathered a large data set of different types of cars across the America market.   

**Business Goal(copied from the Kaggle website)**        

We are required to model the price of cars with the available independent variables. It will be used by the management to understand how exactly the prices vary with the independent variables. They can accordingly manipulate the design of the cars, the business strategy etc. to meet certain price levels. Further, the model will be a good way for management to understand the pricing dynamics of a new market.     

Please Note : The dataset provided is for learning purpose. Please don’t draw any inference with real world scenario.   

**Sample size:**  The total sample size is 205.

**Variables** There are 26 columns identified, including ID and other 25 variables.   
1	Car_ID			Unique id of each observation (Interger)		
2	Symboling 			Its assigned insurance risk rating, A value of +3 indicates that the auto is risky, -3 that it is probably pretty safe.(Categorical) 		
3	carCompany			Name of car company (Categorical)		
4	fueltype			Car fuel type i.e gas or diesel (Categorical)		
5	aspiration			Aspiration used in a car (Categorical)		
6	doornumber			Number of doors in a car (Categorical)		
7	carbody			body of car (Categorical)		
8	drivewheel			type of drive wheel (Categorical)		
9	enginelocation			Location of car engine (Categorical)		
10	wheelbase			Weelbase of car (Numeric)		
11	carlength			Length of car (Numeric)		
12	carwidth			Width of car (Numeric)		
13	carheight			height of car (Numeric)		
14	curbweight			The weight of a car without occupants or baggage. (Numeric)		
15	enginetype			Type of engine. (Categorical)		
16	cylindernumber			cylinder placed in the car (Categorical)		
17	enginesize			Size of car (Numeric)		
18	fuelsystem			Fuel system of car (Categorical)		
19	boreratio			Boreratio of car (Numeric)		
20	stroke			Stroke or volume inside the engine (Numeric)		
21	compressionratio			compression ratio of car (Numeric)		
22	horsepower			Horsepower (Numeric)		
23	peakrpm			car peak rpm (Numeric)		
24	citympg			Mileage in city (Numeric)		
25	highwaympg			Mileage on highway (Numeric)		
26	price(Dependent variable)			Price of car (Numeric)		

**Missing data**  There is no missing data in this dataset.

**Limitation of this dataset**     
- Small sample size   
- The dataset provided is for learning purpose. I can not draw any inference with real world scenario.    
    

# 2. Develop an Analysis Plan   
**My goal:** Build a car price prediction model in the United States, using clustering analysis, principal component analysis, and linear regression model.    

**Major components of the course in your plan**   
- Using GitHub to version control and document my project.   
- Software: Applying R for data manipulation and analysis.    

**Statistical Methodology**      
**Data Wrangling**    
**• Data cleaning:**          
  - Load the dataset and examine their structure (e.g., variables, data types, unique values).     
  - Identify outliers, exclude duplicates, and correct inconsistent formatting.       
**•Descriptive analysis:**         
  - Calculate mean, median, minimum, maximum, variance, and standard deviation for continuous variables; calculate frequency and percentage for categorical variables.     
  - Identify trends or anomalies based on these statistics.       
**• Data Visualization: **        
  - Bar chart     
  - Histograms
  - Boxplot     
  - Scatter plot   
**• Correlation check: scatter plots and Pearson correlation.**    
  
**Model building**  
• **Initial exploratory data analysis (EDA) to understand key features and relationship**            
  - Correlation check         
  - Univariable univariate analysis   
• Split dataset: trainging data (70%) testing data (30%)      
• **Model 1: Linear regression** (supervised learning)    
• **Model 2: Principal component analysis (PCA) + Linear regression** (unsupervised learning + supervised learning)      
  - Avoid multicollinearity among the features      
  - Reduce the dimension of the features    
  - Decide the number of components   
  - Visualize the key components on the plots       
  - Try to identify any meaningful theme for each component      
• **Model 3: Clustering analysis (KMeans) + linear regression** (unsupervised learning + supervised learning)     

**Model evaluation and comparison**     
Compare the three different machine learning method and select the best model       
- Diagnostic visulization (such as residuals plots and posterior predictive check plot)        
- coefficient determination (RSQ)     
- Root Mean Squared Error (RMSE)      

**Interpretation for the best model**    


# 3. Data Wrangling    
**load the library **  
**Import the can_path_data dataset**  
```{r setup}
library(tidyverse)
library(tidymodels)
library(reportRmd)
library(sjPlot)
library(plotly)
library(psych)
library(parallel)
library(finalfit)
library(gtsummary)
library(mlbench)
library(vip)
library(rsample)
library(tune)
library(recipes)
library(yardstick)
library(parsnip)
library(glmnet)
library(themis)
library(corrr)
library(performance)
library(utils)
library(see)
library(forestmodel)
data_carprice<-read.csv("/Users/xiehuangbao/Library/CloudStorage/OneDrive-UniversityofSaskatchewan/Study at USask/CHEP898_Machine Learning/Assignment/Final assignment/CHEP898_Assignment4_Independent-Analysis/CarPrice_Assignment.csv")
```

```{r}
glimpse(data_carprice)
```

There are 26 columns, including ID and other 25 variables.      

The total sample size is 205, which is one of the limitation. The sample size is not big.   


```{r}
sum(duplicated(data_carprice))
```
There is no duplicated data existed in this dataset. 

**Identify the candidates of continuous variables: **     
- 1 output variable: car price (continuous)     
- 24 input variables (11 categorical variables + 13 continuous variables)   
**Categorical variables:**        
insurance risk rating   
Name of car company (Categorical)		    
Car fuel type i.e gas or diesel (Categorical)		  
Aspiration used in a car (Categorical)		
Number of doors in a car (Categorical)		
body of car (Categorical)		  
type of drive wheel (Categorical)       		
Location of car engine (Categorical)      
Type of engine. (Categorical)		    
cylinder placed in the car (Categorical)      
Fuel system of car (Categorical)    
**Continuouis variables:**    
Weelbase of car (Numeric)	  	  
Length of car (Numeric)		    
Width of car (Numeric)		    
height of car (Numeric)		  
The weight of a car without occupants or baggage. (Numeric)     		  
Size of car (Numeric)	      
Boreratio of car (Numeric)	  	    
Stroke or volume inside the engine (Numeric)      		
compression ratio of car (Numeric)		  
Horsepower (Numeric)		  
car peak rpm (Numeric)		  
Mileage in city (Numeric)		    
Mileage on highway (Numeric)		    

```{r}
rm_covsum(data=data_carprice,
covs = c('symboling', 'CarName', 'fueltype', 'aspiration', 'doornumber', 'carbody', 'drivewheel', 'enginelocation', 'enginetype', 'cylindernumber', 'fuelsystem', 
         'wheelbase', 'carlength', 'carwidth', 'carheight', 'curbweight', 'enginesize', 'boreratio', 'stroke', 'compressionratio', 'horsepower', 'peakrpm', 'citympg', 'highwaympg', 'price'))
```

  
There is not missing data.

```{r}
### The categorical variables were changed to factor.   
data_carprice$symboling <- as.factor(data_carprice$symboling)
data_carprice$CarName <- as.factor(data_carprice$CarName)
data_carprice$fueltype <- as.factor(data_carprice$fueltype)
data_carprice$aspiration <- as.factor(data_carprice$aspiration)
data_carprice$doornumber <- as.factor(data_carprice$doornumber)
data_carprice$carbody <- as.factor(data_carprice$carbody)
data_carprice$drivewheel <- as.factor(data_carprice$drivewheel)
data_carprice$enginelocation <- as.factor(data_carprice$enginelocation)
data_carprice$enginetype <- as.factor(data_carprice$enginetype)
data_carprice$cylindernumber <- as.factor(data_carprice$cylindernumber)
data_carprice$fuelsystem <- as.factor(data_carprice$fuelsystem)

glimpse(data_carprice)

```

**Check whether there are outliers: **       

```{r}
boxplot <- ggplot(data_carprice, aes(price)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(wheelbase)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(carlength)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(carwidth)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(carheight)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(curbweight)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(enginesize)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(boreratio)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(stroke)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(compressionratio)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(horsepower)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(peakrpm)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(citympg)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

boxplot <- ggplot(data_carprice, aes(highwaympg)) + 
              geom_boxplot() + 
              coord_flip()  
plot(boxplot)

```

Variables Price, Weelbase of car, Width of car,	Size of car, Stroke or volume inside the engine, Compression ratio of car, Horsepower, Car peak rpm, Mileage in city, Mileage on highway were identified with outliers. For example, output (outcome variable) price have some outlierw with high price.     


**Calculate the descriptive statistics (frequency and percentage) for categorical variables**   

```{r}
symboling_table <- bind_rows(table(data_carprice$symboling), prop.table(table(data_carprice$symboling)))
symboling_table
CarName_table <- bind_rows(table(data_carprice$CarName), prop.table(table(data_carprice$CarName)))
CarName_table
fueltype_table <- bind_rows(table(data_carprice$fueltype), prop.table(table(data_carprice$fueltype)))
fueltype_table
aspiration_table <- bind_rows(table(data_carprice$aspiration), prop.table(table(data_carprice$aspiration)))
aspiration_table
doornumber_table <- bind_rows(table(data_carprice$doornumber), prop.table(table(data_carprice$doornumber)))
doornumber_table
carbody_table <- bind_rows(table(data_carprice$carbody), prop.table(table(data_carprice$carbody)))
carbody_table
drivewheel_table <- bind_rows(table(data_carprice$drivewheel), prop.table(table(data_carprice$drivewheel)))
drivewheel_table
enginelocation_table <- bind_rows(table(data_carprice$enginelocation), prop.table(table(data_carprice$enginelocation)))
enginelocation_table
enginetype_table <- bind_rows(table(data_carprice$enginetype), prop.table(table(data_carprice$enginetype)))
enginetype_table
cylindernumber_table <- bind_rows(table(data_carprice$cylindernumber), prop.table(table(data_carprice$cylindernumber)))
cylindernumber_table
fuelsystem_table <- bind_rows(table(data_carprice$fuelsystem), prop.table(table(data_carprice$fuelsystem)))
fuelsystem_table

```

**Calculate the descriptive statistics for the continuous variables**. 
```{r}
summary(data_carprice$price)
sd(data_carprice$price, na.rm = TRUE)
summary(data_carprice$wheelbase)
sd(data_carprice$wheelbase, na.rm = TRUE)
summary(data_carprice$carlength)
sd(data_carprice$carlength, na.rm = TRUE)
summary(data_carprice$carwidth)
sd(data_carprice$carwidth, na.rm = TRUE)
summary(data_carprice$carheight)
sd(data_carprice$carheight, na.rm = TRUE)
summary(data_carprice$curbweight)
sd(data_carprice$curbweight, na.rm = TRUE)
summary(data_carprice$enginesize)
sd(data_carprice$enginesize, na.rm = TRUE)
summary(data_carprice$boreratio)
sd(data_carprice$boreratio, na.rm = TRUE)
summary(data_carprice$stroke)
sd(data_carprice$stroke, na.rm = TRUE)
summary(data_carprice$compressionratio)
sd(data_carprice$compressionratio, na.rm = TRUE)
summary(data_carprice$horsepower)
sd(data_carprice$horsepower, na.rm = TRUE)
summary(data_carprice$peakrpm)
sd(data_carprice$peakrpm, na.rm = TRUE)
summary(data_carprice$citympg)
sd(data_carprice$citympg, na.rm = TRUE)
summary(data_carprice$highwaympg)
sd(data_carprice$highwaympg, na.rm = TRUE)
```


Output (outcome) variable has a wide price range from 5118 to 45400. 

**Data Visualization**      

**Bar graphs for categorical variables**    
```{r}
bar_symboling <- ggplot(data_carprice, aes(symboling)) + 
                geom_bar(width=0.3) + 
                labs(x = "insurance risk rating") + 
                theme(axis.text.x = element_text())       
plot(bar_symboling)

bar_CarName <- ggplot(data_carprice, aes(CarName)) + 
                geom_bar(width=0.3) + 
                labs(x = "CarName") + 
                theme(axis.text.x = element_text())       
plot(bar_CarName)

bar_fueltype <- ggplot(data_carprice, aes(fueltype)) + 
                geom_bar(width=0.3) + 
                labs(x = "fuel type") + 
                theme(axis.text.x = element_text())       
plot(bar_fueltype)

bar_aspiration <- ggplot(data_carprice, aes(aspiration)) + 
                geom_bar(width=0.3) + 
                labs(x = "Aspiration used in a car") + 
                theme(axis.text.x = element_text())       
plot(bar_aspiration)

bar_doornumber <- ggplot(data_carprice, aes(doornumber)) + 
                geom_bar(width=0.3) + 
                labs(x = "door number") + 
                theme(axis.text.x = element_text())       
plot(bar_doornumber)

bar_carbody <- ggplot(data_carprice, aes(carbody)) + 
                geom_bar(width=0.3) + 
                labs(x = "car body") + 
                theme(axis.text.x = element_text())       
plot(bar_carbody)


bar_drivewheel <- ggplot(data_carprice, aes(drivewheel)) + 
                geom_bar(width=0.3) + 
                labs(x = "type of drive wheel") + 
                theme(axis.text.x = element_text())       
plot(bar_drivewheel)

bar_enginelocation <- ggplot(data_carprice, aes(enginelocation)) + 
                geom_bar(width=0.3) + 
                labs(x = "engine location") + 
                theme(axis.text.x = element_text())       
plot(bar_enginelocation)

bar_enginetype <- ggplot(data_carprice, aes(enginetype)) + 
                geom_bar(width=0.3) + 
                labs(x = "engine type") + 
                theme(axis.text.x = element_text())       
plot(bar_enginetype)

bar_cylindernumber <- ggplot(data_carprice, aes(cylindernumber)) + 
                geom_bar(width=0.3) + 
                labs(x = "cylinder number") + 
                theme(axis.text.x = element_text())       
plot(bar_cylindernumber)

bar_fuelsystem <- ggplot(data_carprice, aes(fuelsystem)) + 
                geom_bar(width=0.3) + 
                labs(x = "fuelsystem") + 
                theme(axis.text.x = element_text())       
plot(bar_fuelsystem)

```
Most cars's fuel type is gas (90.2%). Most cars used standard aspiration (82.0%).  Sedan and hatchback accout for 81.0% among all the car body types. 4WD only account for 4.4% among all the types of drive wheel. The majority of the engine location is at the front (98.5%). About 72.2% of the cars's engine type is ohc. About 77.6% of the cars have four cylinders.    


**Histogram graphs for continuous variables:**    
```{r}
histo_price <- ggplot(data_carprice, aes(price)) + 
              geom_histogram(binwidth = 1)
plot(histo_price)

histo_wheelbase <- ggplot(data_carprice, aes(wheelbase)) + 
              geom_histogram(binwidth = 1)
plot(histo_wheelbase)

histo_carlength <- ggplot(data_carprice, aes(carlength)) + 
              geom_histogram(binwidth = 1)
plot(histo_carlength)

histo_carwidth <- ggplot(data_carprice, aes(carwidth)) + 
              geom_histogram(binwidth = 1)
plot(histo_carwidth)

histo_carheight <- ggplot(data_carprice, aes(carheight)) + 
              geom_histogram(binwidth = 1)
plot(histo_carheight)

histo_curbweight <- ggplot(data_carprice, aes(curbweight)) + 
              geom_histogram(binwidth = 1)
plot(histo_curbweight)

histo_enginesize <- ggplot(data_carprice, aes(enginesize)) + 
              geom_histogram(binwidth = 1)
plot(histo_enginesize)

histo_boreratio <- ggplot(data_carprice, aes(boreratio)) + 
              geom_histogram(binwidth = 1)
plot(histo_boreratio)

histo_stroke <- ggplot(data_carprice, aes(stroke)) + 
              geom_histogram(binwidth = 1)
plot(histo_stroke)

histo_compressionratio <- ggplot(data_carprice, aes(compressionratio)) + 
              geom_histogram(binwidth = 1)
plot(histo_compressionratio)

histo_horsepower <- ggplot(data_carprice, aes(horsepower)) + 
              geom_histogram(binwidth = 1)
plot(histo_horsepower)

histo_peakrpm <- ggplot(data_carprice, aes(peakrpm)) + 
              geom_histogram(binwidth = 1)
plot(histo_peakrpm)

histo_citympg <- ggplot(data_carprice, aes(citympg)) + 
              geom_histogram(binwidth = 1)
plot(histo_citympg)

histo_highwaympg <- ggplot(data_carprice, aes(highwaympg)) + 
              geom_histogram(binwidth = 1)
plot(histo_highwaympg)

```  

Based on the above histogram, I suspect none of the distribution of the above continuos variables is normal.    

**Scatter plots for the outcome variable price and the continuous variables:**

```{r}
scatter_plot_price_wheelbase <- ggplot(data_carprice, aes(x = wheelbase, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "wheelbase", y = "price")
plot(scatter_plot_price_wheelbase)

scatter_plot_price_carlength <- ggplot(data_carprice, aes(x = carlength, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "carlength", y = "price")
plot(scatter_plot_price_carlength)

scatter_plot_price_carwidth <- ggplot(data_carprice, aes(x = carwidth, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "carwidth", y = "price")
plot(scatter_plot_price_carwidth)

scatter_plot_price_carheight <- ggplot(data_carprice, aes(x = carheight, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "carheight", y = "price")
plot(scatter_plot_price_carheight)


scatter_plot_price_curbweight <- ggplot(data_carprice, aes(x = curbweight, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "curbweight", y = "price")
plot(scatter_plot_price_curbweight)


scatter_plot_price_enginesize <- ggplot(data_carprice, aes(x = enginesize, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "enginesize", y = "price")
plot(scatter_plot_price_enginesize)

scatter_plot_price_boreratio <- ggplot(data_carprice, aes(x = boreratio, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "boreratio", y = "price")
plot(scatter_plot_price_boreratio)

scatter_plot_price_stroke <- ggplot(data_carprice, aes(x = stroke, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "stroke", y = "price")
plot(scatter_plot_price_stroke)


scatter_plot_price_compressionratio <- ggplot(data_carprice, aes(x = compressionratio, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "compressionratio", y = "price")
plot(scatter_plot_price_compressionratio)


scatter_plot_price_horsepower <- ggplot(data_carprice, aes(x = horsepower, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "horsepower", y = "price")
plot(scatter_plot_price_horsepower)

scatter_plot_price_peakrpm <- ggplot(data_carprice, aes(x = peakrpm, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "peakrpm", y = "price")
plot(scatter_plot_price_peakrpm)


scatter_plot_price_citympg <- ggplot(data_carprice, aes(x = citympg, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "citympg", y = "price")
plot(scatter_plot_price_citympg)


scatter_plot_price_highwaympg <- ggplot(data_carprice, aes(x = highwaympg, y = price)) + 
                  geom_point(alpha=0.3) +
                  geom_smooth(colour = "red") + 
                  geom_smooth(method = "lm", colour = "#088da5") +
                  labs(x = "highwaympg", y = "price")
plot(scatter_plot_price_highwaympg)
```  


**Correlation check:**    

```{r}
data_carprice %>% 
  correlate() %>%
  rearrange() %>%
  shave()  %>%
  rplot(print_cor=TRUE) +
  theme(axis.text.x = element_text(angle = 90))  
```   


From the scatter plots and the pearson correlation plot:    
- outcome variable price is moderate positive correlated to car length,  boreratio of car, and weelbase of car.      
- outcome variable price is strong positive correlated to car width, car weight, horse power, and engine size.         
- outcome variable price is moderate negative correlated to mileage on highway and mileage in city.     
This proivides evidence to include those variables in the model for linear regression model.      

The multicollinearity was detected among those continuous variables, which provides rationals to conduct PCA to avoid multicollinearity.    

